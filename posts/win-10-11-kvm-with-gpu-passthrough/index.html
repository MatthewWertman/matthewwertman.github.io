<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="prefer-datetime-locale" content="en"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Create a Win10/11 KVM virtual machine with GPU passthrough" /><meta name="author" content="Matthew Wertman" /><meta property="og:locale" content="en" /><meta name="description" content="Introduction In this post, I will be giving detailed instructions on how to setup a Windows 10/11 KVM-based VM (Virtual Machine) with GPU passthrough." /><meta property="og:description" content="Introduction In this post, I will be giving detailed instructions on how to setup a Windows 10/11 KVM-based VM (Virtual Machine) with GPU passthrough." /><link rel="canonical" href="https://matthewwertman.github.io/posts/win-10-11-kvm-with-gpu-passthrough/" /><meta property="og:url" content="https://matthewwertman.github.io/posts/win-10-11-kvm-with-gpu-passthrough/" /><meta property="og:site_name" content="MattWert.io" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2025-07-01T00:04:00-07:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Create a Win10/11 KVM virtual machine with GPU passthrough" /><meta name="twitter:site" content="@username" /><meta name="twitter:creator" content="@mattwert57" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Matthew Wertman","url":"https://github.com/MatthewWertman/"},"dateModified":"2025-07-01T00:04:00-07:00","datePublished":"2025-07-01T00:04:00-07:00","description":"Introduction In this post, I will be giving detailed instructions on how to setup a Windows 10/11 KVM-based VM (Virtual Machine) with GPU passthrough.","headline":"Create a Win10/11 KVM virtual machine with GPU passthrough","mainEntityOfPage":{"@type":"WebPage","@id":"https://matthewwertman.github.io/posts/win-10-11-kvm-with-gpu-passthrough/"},"url":"https://matthewwertman.github.io/posts/win-10-11-kvm-with-gpu-passthrough/"}</script><title>Create a Win10/11 KVM virtual machine with GPU passthrough | MattWert.io</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="MattWert.io"><meta name="application-name" content="MattWert.io"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/37555232.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">MattWert.io</a></div><div class="site-subtitle font-italic">Talks, Projects and Opinions Related to Development.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/MatthewWertman" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://mastodon.social/web/@MatthewWertman" aria-label="mastodon" target="_blank" rel="noopener"> <i class="fab fa-mastodon"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['matthewwertman57','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Create a Win10/11 KVM virtual machine with GPU passthrough</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Create a Win10/11 KVM virtual machine with GPU passthrough</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1751353440" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Jul 1, 2025 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/MatthewWertman/">Matthew Wertman</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1580 words"> <em>8 min</em> read</span></div></div></div><div class="post-content"><h2 id="introduction"><span class="mr-2">Introduction</span><a href="#introduction" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>In this post, I will be giving detailed instructions on how to setup a Windows 10/11 KVM-based VM (Virtual Machine) with GPU passthrough.</p><p>This guide includes how to setup your GPU with VFIO, creating the Win10 or Win11 Virtual machine within VMM (Virtual Machine Manager), configuring the VM for PCIe/GPU passthrough, and setting up the VM with the <a href="https://looking-glass.io/">Looking Glass</a> client.</p><h2 id="why"><span class="mr-2">Why?</span><a href="#why" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>This guide is for people wanting to achieve a high-performing local Windows VM on a Linux host without the need of dual-booting.</p><h3 id="quick-aside-gaming-on-linux"><span class="mr-2">Quick aside: Gaming on Linux</span><a href="#quick-aside-gaming-on-linux" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Gaming on Linux has been a real pain point in the past. But withing the last few years, it has gotten way better with the help of Valve’s <a href="https://github.com/ValveSoftware/Proton">Proton</a> compatability layer for Steam. However, even still, some games do require windows as the only way to play on PC. For example, online games that utilize Anti-Cheat software or DRM.</p><p>This is the main reason I wanted a solution like this without the need to dual-boot or paying for a cloud provider subscription. Having something like this allows me to seemlessly switch between my Linux host and Windows guest and have very-comparable performance to running native Windows.</p><p>This comes with a cost of it’s own, unfortually. This setup is quite lengthy and tedious and may have to adjust some steps to get it working for you. To get a setup like this working for my system took a lot of trail and error, but hopefully this guide can aid to avoiding some of the pitfalls that occur in this process.</p><h2 id="resources"><span class="mr-2">Resources</span><a href="#resources" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Here is some further reading material that I have used to make this guide.</p><ul><li>Arch Wiki <a href="https://wiki.archlinux.org/title/PCI_passthrough_via_OVMF">PCI passthrough via OVMF</a><li>bryansteiner’s guide <a href="https://github.com/bryansteiner/gpu-passthrough-tutorial/blob/master/README.md">gpu-passthrough-tutorial</a><li><a href="https://looking-glass.io/docs/B7/">Looking Glass Docs</a></ul><h2 id="hardware-requirements"><span class="mr-2">Hardware Requirements</span><a href="#hardware-requirements" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>Two GPUs (one guest GPU dedicated to the VM)<li>CPU that supports hardware virtualization (Intel VT-x/VT-d or AMD-Vi) See the <a href="https://wiki.archlinux.org/title/PCI_passthrough_via_OVMF#Prerequisites">Arch Wiki</a> for more detailed list of CPUs<li>Motherboard that supports <a href="https://en.wikipedia.org/wiki/List_of_IOMMU-supporting_hardware">IOMMU</a><li>Guest GPU ROM must support UEFI. Can find your GPU make/model <a href="https://www.techpowerup.com/vgabios/">here</a> and verify<li>Monitor with multiple inputs or multiple monitors</ul><h2 id="looking-glass-peripherals"><span class="mr-2">Looking Glass peripherals</span><a href="#looking-glass-peripherals" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li>Secondary keyboard and mouse<li>HMDI cable or optionally HDMI dummy adapter</ul><h2 id="hardware-setup"><span class="mr-2">Hardware Setup</span><a href="#hardware-setup" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>My current configuration is as follows:</p><ul><li>CPU<ul><li>AMD Ryzen 7 5700X</ul><li>Motherboard<ul><li>MSI MPG B550</ul><li>GPUs<ul><li>NVIDIA RTX 3070 (Guest Card)<li>AMD Radeon RX 6800 (Host Card)</ul><li>RAM<ul><li>64GB DDR4 (4x16)</ul></ul><p>OS: Pop!_OS 22.04</p><p>Kernel: 6.12.10-76061203-generic</p><h2 id="getting-started"><span class="mr-2">Getting started</span><a href="#getting-started" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Firstly, lets get some needed dependencies that we will need.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>apt <span class="nb">install </span>libvirt-daemon-system libvirt-clients qemu-kvm qemu-utils qemu ovmf bridge-utils virt-manager virt-viewer libosinfo-bin <span class="nt">-y</span>
</pre></table></code></div></div><p>After installing the packages, reboot your system into the BIOS to enable ‘VT-d’ or “Virtualization Technology” for Intel CPUs or ‘AMD-Vi’ for AMD if you haven’t already.</p><p>To ensure that CPU virtualization is enabled:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>dmesg | <span class="nb">grep </span>VT-d    <span class="c"># for Intel</span>
dmesg | <span class="nb">grep </span>AMD-Vi  <span class="c"># for AMD</span>
</pre></table></code></div></div><p>Secondly verify that IOMMU is enabled:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>dmesg | <span class="nb">grep</span> <span class="nt">-i</span> IOMMU
</pre></table></code></div></div><p>Should look something like this if enabled</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre>[    0.000000] ACPI: DMAR 0x00000000BDCB1CB0 0000B8 (v01 INTEL  BDW      00000001 INTL 00000001)
[    0.000000] Intel-IOMMU: enabled
[    0.028879] dmar: IOMMU 0: reg_base_addr fed90000 ver 1:0 cap c0000020660462 ecap f0101a
[    0.028883] dmar: IOMMU 1: reg_base_addr fed91000 ver 1:0 cap d2008c20660462 ecap f010da
[    0.028950] IOAPIC id 8 under DRHD base  0xfed91000 IOMMU 1
[    0.536212] DMAR: No ATSR found
[    0.536229] IOMMU 0 0xfed90000: using Queued invalidation
[    0.536230] IOMMU 1 0xfed91000: using Queued invalidation
[    0.536231] IOMMU: Setting RMRR:
[    0.536241] IOMMU: Setting identity map for device 0000:00:02.0 [0xbf000000 - 0xcf1fffff]
[    0.537490] IOMMU: Setting identity map for device 0000:00:14.0 [0xbdea8000 - 0xbdeb6fff]
[    0.537512] IOMMU: Setting identity map for device 0000:00:1a.0 [0xbdea8000 - 0xbdeb6fff]
[    0.537530] IOMMU: Setting identity map for device 0000:00:1d.0 [0xbdea8000 - 0xbdeb6fff]
[    0.537543] IOMMU: Prepare 0-16MiB unity mapping for LPC
[    0.537549] IOMMU: Setting identity map for device 0000:00:1f.0 [0x0 - 0xffffff]
[    2.182790] [drm] DMAR active, disabling use of stolen memory
</pre></table></code></div></div><h3 id="force-setting-iommu-in-kernel-parameters"><span class="mr-2">Force setting IOMMU in kernel parameters</span><a href="#force-setting-iommu-in-kernel-parameters" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>To ensure that IOMMU is enabled <em>everytime</em>, you can set in your kernel parameters. For AMD users, this is not necessary as it is automatically enabled if your hardware supports it.</p><p>In my case, I am using systemd as my boot loader:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>kernelstub <span class="nt">--add-optinos</span> <span class="s2">"intel_iommu=on"</span>  <span class="c"># for Intel</span>
<span class="nb">sudo </span>kernelstub <span class="nt">--add-options</span> <span class="s2">"amd_iommu=on"</span>    <span class="c"># for AMD</span>
</pre></table></code></div></div><p>If you are on GRUB, you can set it by editing <code class="language-plaintext highlighter-rouge">/etc/default/grub</code>:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>GRUB_CMDLINE_LINUX_DEFAULT="quiet splash intel_iommu=on"  # for Intel
GRUB_CMDLINE_LINUX_DEFAULT="quiet splash amd_iommu=on"    # for AMD
</pre></table></code></div></div><h3 id="finding-iommu-groups"><span class="mr-2">Finding IOMMU Groups</span><a href="#finding-iommu-groups" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>An IOMMU group is the smallest set of devices that can be passed into the VM. Meaning all devices within the group have to be passed into the VM. This can be a little bit tricky, but you want your Guest GPU that you are gonna pass in to be into its own isolated group.</p><p>To see how your IOMMU groups are mapped out currently you can run the following bash script:</p><div file="iommu_groups" class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="iommu_groups"><i class="far fa-file-code"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="c">#!/bin/bash</span>
<span class="c">##</span>
<span class="k">for </span>d <span class="k">in</span> /sys/kernel/iommu_groups/<span class="k">*</span>/devices/<span class="k">*</span><span class="p">;</span> <span class="k">do
    </span><span class="nv">n</span><span class="o">=</span><span class="k">${</span><span class="nv">d</span><span class="p">#*/iommu_groups/*</span><span class="k">}</span><span class="p">;</span> <span class="nv">n</span><span class="o">=</span><span class="k">${</span><span class="nv">n</span><span class="p">%%/*</span><span class="k">}</span>
    <span class="nb">printf</span> <span class="s1">'IOMMU Group %s '</span> <span class="s2">"</span><span class="nv">$n</span><span class="s2">"</span>
    lspci <span class="nt">-nns</span> <span class="s2">"</span><span class="k">${</span><span class="nv">d</span><span class="p">##*/</span><span class="k">}</span><span class="s2">"</span>
<span class="k">done</span>
</pre></table></code></div></div><p>Example output:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>IOMMU Group 15 04:00.0 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD/ATI] Navi 10 XL Upstream Port of PCI Express Switch [1002:1478] (rev c3)
IOMMU Group 15 05:00.0 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD/ATI] Navi 10 XL Downstream Port of PCI Express Switch [1002:1479]
IOMMU Group 15 06:00.0 VGA compatible controller [0300]: Advanced Micro Devices, Inc. [AMD/ATI] Navi 21 [Radeon RX 6800/6800 XT / 6900 XT] [1002:73bf] (rev c3)
IOMMU Group 15 06:00.1 Audio device [0403]: Advanced Micro Devices, Inc. [AMD/ATI] Navi 21 HDMI Audio [Radeon RX 6800/6800 XT / 6900 XT] [1002:ab28]
IOMMU Group 15 2a:00.0 Ethernet controller [0200]: Realtek Semiconductor Co., Ltd. RTL8111/8168/8411 PCI Express Gigabit Ethernet Controller [10ec:8168] (rev 15)
IOMMU Group 16 2b:00.0 VGA compatible controller [0300]: NVIDIA Corporation GA104 [GeForce RTX 3070] [10de:2484] (rev a1)
IOMMU Group 16 2b:00.1 Audio device [0403]: NVIDIA Corporation GA104 High Definition Audio Controller [10de:228b] (rev a1)
</pre></table></code></div></div><p>If your Guest GPU isnt isolated in its own group. You will need to figure out a way to separate it out.</p><ol><li>If your Guest GPU is not in the top slot of your motherboard, you can try swapping it with your Host GPU. This may vary the grouping so that your Guest GPU is in it’s own group.<li>If you have any other PCIe devices installed that are attached to that same slot of your Guest GPU (i.e an NVME drive). you can try moving that device to another slot.<li>An alternative solution is <a href="https://wiki.archlinux.org/title/PCI_passthrough_via_OVMF#Bypassing_the_IOMMU_groups_(ACS_override_patch)">ACS override patch</a>. Can also check out <a href="https://vfio.blogspot.com/2014/08/iommu-groups-inside-and-out.html">this post</a> by Alex Williamson. BEWARE as this comes with some <a href="https://www.reddit.com/r/VFIO/comments/bvif8d/official_reason_why_acs_override_patch_is_not_in/">risks</a>.</ol><p>For my motherboard, I had to swap my GPUs around to get the Guest GPU into its own group.</p><p>If you are able to isolate your GPU, like in the example above. You can continue to the next step!</p><h2 id="binding-vfio-drivers-to-the-guest-gpu"><span class="mr-2">Binding VFIO drivers to the Guest GPU</span><a href="#binding-vfio-drivers-to-the-guest-gpu" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>There are many ways to achieve this. You can dynamically bind and unbind the VFIO drivers via <a href="https://www.libvirt.org/hooks.html">libvirt hooks</a> if you still want to utilize your Guest GPU when the VM is not running. See <a href="https://github.com/bryansteiner/gpu-passthrough-tutorial?tab=readme-ov-file#----part-2-vm-logistics">bryansteiner’s guide</a> for an example setup. I havent had much luck with this however, but your mileage may vary. For this guide, I am simply going to disable/uninstall the nvidia drivers and early-load the VFIO drivers as my Guest GPU will be dedicated to the VM.</p><h3 id="blacklisting-nvidia-drivers"><span class="mr-2">Blacklisting Nvidia drivers</span><a href="#blacklisting-nvidia-drivers" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>bash <span class="nt">-c</span> <span class="s2">"echo blacklist nouveau &gt; /etc/modprobe.d/blacklist-nvidia-nouveau.conf"</span>
<span class="nb">sudo </span>bash <span class="nt">-c</span> <span class="s2">"echo options nouveau modeset=0 &gt;&gt; /etc/modprobe.d/blacklist-nvidia-nouveau.conf"</span>
</pre></table></code></div></div><h3 id="uninstalling-the-nvidia-drivers"><span class="mr-2">Uninstalling the Nvidia drivers</span><a href="#uninstalling-the-nvidia-drivers" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Again, this setup is not necessary. But, in my case, I have no need for them.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>apt-get remove <span class="nt">--purge</span>  <span class="s1">'^nvidia-.*'</span>
</pre></table></code></div></div><h3 id="binding-the-vfio-drivers"><span class="mr-2">Binding the VFIO drivers</span><a href="#binding-the-vfio-drivers" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>To bind the guest GPU to the VFIO drivers, you will need the PCI vendor ID for <em>everything</em> within the IOMMU group.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>lspci <span class="nt">-nn</span>
</pre></table></code></div></div><p>Example output:</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>05:00.0 PCI bridge [0604]: Advanced Micro Devices, Inc. [AMD/ATI] Navi 10 XL Downstream Port of PCI Express Switch [1002:1479]
06:00.0 VGA compatible controller [0300]: Advanced Micro Devices, Inc. [AMD/ATI] Navi 21 [Radeon RX 6800/6800 XT / 6900 XT] [1002:73bf] (rev c3)
06:00.1 Audio device [0403]: Advanced Micro Devices, Inc. [AMD/ATI] Navi 21 HDMI Audio [Radeon RX 6800/6800 XT / 6900 XT] [1002:ab28]
2a:00.0 Ethernet controller [0200]: Realtek Semiconductor Co., Ltd. RTL8111/8168/8411 PCI Express Gigabit Ethernet Controller [10ec:8168] (rev 15)
2b:00.0 VGA compatible controller [0300]: NVIDIA Corporation GA104 [GeForce RTX 3070] [10de:2484] (rev a1)
2b:00.1 Audio device [0403]: NVIDIA Corporation GA104 High Definition Audio Controller [10de:228b] (rev a1)
2c:00.0 Non-Essential Instrumentation [1300]: Advanced Micro Devices, Inc. [AMD] Starship/Matisse PCIe Dummy Function [1022:148a]
2d:00.0 Non-Essential Instrumentation [1300]: Advanced Micro Devices, Inc. [AMD] Starship/Matisse Reserved SPP [1022:1485]
2d:00.1 Encryption controller [1080]: Advanced Micro Devices, Inc. [AMD] Starship/Matisse Cryptographic Coprocessor PSPCPP [1022:1486]
2d:00.3 USB controller [0c03]: Advanced Micro Devices, Inc. [AMD] Matisse USB 3.0 Host Controller [1022:149c]
2d:00.4 Audio device [0403]: Advanced Micro Devices, Inc. [AMD] Starship/Matisse HD Audio Controller [1022:1487]
</pre></table></code></div></div><p>My guest GPU is busid <code class="language-plaintext highlighter-rouge">2b:00.0</code> and <code class="language-plaintext highlighter-rouge">2b:00.1</code> which in the table above shows the vendor ids in the square brackets. So <code class="language-plaintext highlighter-rouge">10de:2484</code> and <code class="language-plaintext highlighter-rouge">10de:228b</code></p><p>After you have the vendor IDs, you can set the kernel parameter to ensure that they bind after every boot:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">sudo </span>kernelstub <span class="nt">--add-option</span> vfio-pci.ids<span class="o">=</span>10de:2484,10de:228b
</pre></table></code></div></div><p>Finally, reboot your system to start creating the VM!</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/writing/'>writing</a>, <a href='/categories/linux/'>linux</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/win10/" class="post-tag no-text-decoration" >win10</a> <a href="/tags/qemu/" class="post-tag no-text-decoration" >qemu</a> <a href="/tags/kvm/" class="post-tag no-text-decoration" >kvm</a> <a href="/tags/libvirt/" class="post-tag no-text-decoration" >libvirt</a> <a href="/tags/pcie/" class="post-tag no-text-decoration" >pcie</a> <a href="/tags/tutorial/" class="post-tag no-text-decoration" >tutorial</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Create+a+Win10%2F11+KVM+virtual+machine+with+GPU+passthrough+-+MattWert.io&url=https%3A%2F%2Fmatthewwertman.github.io%2Fposts%2Fwin-10-11-kvm-with-gpu-passthrough%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Create+a+Win10%2F11+KVM+virtual+machine+with+GPU+passthrough+-+MattWert.io&u=https%3A%2F%2Fmatthewwertman.github.io%2Fposts%2Fwin-10-11-kvm-with-gpu-passthrough%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fmatthewwertman.github.io%2Fposts%2Fwin-10-11-kvm-with-gpu-passthrough%2F&text=Create+a+Win10%2F11+KVM+virtual+machine+with+GPU+passthrough+-+MattWert.io" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/little-martian/">All About Little Martian!</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/tutorial/">tutorial</a> <a class="post-tag" href="/tags/pcie/">pcie</a> <a class="post-tag" href="/tags/crypto/">crypto</a> <a class="post-tag" href="/tags/hello-world/">hello-world</a> <a class="post-tag" href="/tags/hiveos/">hiveos</a> <a class="post-tag" href="/tags/kvm/">kvm</a> <a class="post-tag" href="/tags/libvirt/">libvirt</a> <a class="post-tag" href="/tags/little-martian/">little-martian</a> <a class="post-tag" href="/tags/mining/">mining</a> <a class="post-tag" href="/tags/momentum-mod/">momentum-mod</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/using-PIR-table-for-PCIe-device-order/"><div class="card-body"> <em class="small" data-ts="1713596640" data-df="ll" > Apr 20, 2024 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Using the $PIR Table to get PCIe device order</h3><div class="text-muted small"><p> Identifying PCIe devices physically in a system can be a challenging problem. In my experience, when you have 6, 8, 12 PCIe devices in a system (GPUs in my case), they often don’t show up how you w...</p></div></div></a></div><div class="card"> <a href="/posts/little-martian/"><div class="card-body"> <em class="small" data-ts="1658685180" data-df="ll" > Jul 24, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>All About Little Martian!</h3><div class="text-muted small"><p> Brief introduction on how I found one of my favorite games to both play and develop! Origin Story Little Martian is a open world survival craft game (as of now, just a demo) created by Charlie, Ja...</p></div></div></a></div><div class="card"> <a href="/posts/getting-started-momentum-mod/"><div class="card-body"> <em class="small" data-ts="1674151440" data-df="ll" > Jan 19, 2023 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Momentum Mod - Getting Started</h3><div class="text-muted small"><p> Momentum Mod is the hottest mod on the street right now, if you are into custom Source Engine game modes. This guide will go over the following: What is Momentum Mod? How do I install it? Ho...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/using-PIR-table-for-PCIe-device-order/" class="btn btn-outline-primary" prompt="Older"><p>Using the $PIR Table to get PCIe device order</p></a><div class="btn btn-outline-primary disabled" prompt="Newer"><p>-</p></div></div></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2025 <a href="https://github.com/MatthewWertman">Matthew Wertman</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/tutorial/">tutorial</a> <a class="post-tag" href="/tags/pcie/">pcie</a> <a class="post-tag" href="/tags/crypto/">crypto</a> <a class="post-tag" href="/tags/hello-world/">hello-world</a> <a class="post-tag" href="/tags/hiveos/">hiveos</a> <a class="post-tag" href="/tags/kvm/">kvm</a> <a class="post-tag" href="/tags/libvirt/">libvirt</a> <a class="post-tag" href="/tags/little-martian/">little-martian</a> <a class="post-tag" href="/tags/mining/">mining</a> <a class="post-tag" href="/tags/momentum-mod/">momentum-mod</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
